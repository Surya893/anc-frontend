<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANC Platform - Redefining Silence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0071e3;
            --primary-dark: #0077ED;
            --accent: #06c;
            --success: #30d158;
            --warning: #ff9f0a;
            --danger: #ff3b30;
            --bg-dark: #000000;
            --bg-secondary: #1d1d1f;
            --text-primary: #f5f5f7;
            --text-secondary: #a1a1a6;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Animated gradient background */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
            z-index: -2;
        }

        .bg-gradient::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 113, 227, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Glass morphism container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Hero section */
        .hero {
            text-align: center;
            padding: 80px 20px 60px;
            position: relative;
        }

        .hero h1 {
            font-size: clamp(48px, 8vw, 96px);
            font-weight: 800;
            letter-spacing: -0.03em;
            background: linear-gradient(135deg, #ffffff 0%, #a1a1a6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            line-height: 1.1;
        }

        .hero .tagline {
            font-size: clamp(20px, 3vw, 32px);
            font-weight: 300;
            color: var(--text-secondary);
            margin-bottom: 40px;
            letter-spacing: -0.01em;
        }

        .hero .subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 60px;
            line-height: 1.6;
        }

        /* Glass card */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        .card-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 24px;
            letter-spacing: -0.02em;
        }

        /* Main control panel */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 968px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
        }

        /* ANC Toggle - Premium design */
        .anc-toggle-container {
            text-align: center;
            padding: 40px;
        }

        .anc-status {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .anc-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            cursor: pointer;
            position: relative;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: white;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 113, 227, 0.3);
        }

        .anc-button:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 70px rgba(0, 113, 227, 0.4);
        }

        .anc-button:active {
            transform: scale(0.98);
        }

        .anc-button.active {
            background: linear-gradient(135deg, var(--success) 0%, #28a745 100%);
            box-shadow: 0 20px 60px rgba(48, 209, 88, 0.4);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 20px 60px rgba(48, 209, 88, 0.4);
            }
            50% {
                box-shadow: 0 20px 70px rgba(48, 209, 88, 0.6);
            }
        }

        .anc-button::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .anc-button:hover::before {
            opacity: 1;
        }

        /* Waveform visualization */
        .waveform-container {
            position: relative;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        .waveform-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .waveform-label {
            position: absolute;
            top: 12px;
            left: 16px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Audio controls */
        .audio-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 32px;
        }

        .noise-button {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .noise-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .noise-button:hover::before {
            left: 100%;
        }

        .noise-button:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .noise-button.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .noise-button .icon {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }

        /* Comparison controls */
        .comparison-section {
            margin-top: 32px;
        }

        .comparison-toggle {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .compare-button {
            flex: 1;
            max-width: 200px;
            padding: 16px 32px;
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .compare-button.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(0, 113, 227, 0.3);
        }

        /* Slider with premium styling */
        .slider-container {
            margin: 32px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .slider-value {
            color: var(--primary);
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            position: relative;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 32px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--success) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        /* Volume meter */
        .volume-meter {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 16px;
        }

        .volume-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--warning) 50%, var(--danger) 100%);
            width: 0%;
            transition: width 0.1s linear;
            border-radius: 4px;
        }

        /* Feature pills */
        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 40px;
        }

        .feature-pill {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .feature-pill:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 20px;
        }

        /* Loading animation */
        .loading-ring {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 48px;
            }

            .hero .tagline {
                font-size: 24px;
            }

            .glass-card {
                padding: 24px;
            }

            .anc-button {
                width: 160px;
                height: 160px;
            }
        }

        /* Notification toast */
        .toast {
            position: fixed;
            bottom: 32px;
            right: 32px;
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px 24px;
            box-shadow: var(--shadow-lg);
            transform: translateY(120%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-text {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 14px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h1>ANC Platform</h1>
            <div class="tagline">Experience Silence, Redefined</div>
            <p class="subtitle">
                Advanced noise cancellation powered by machine learning.
                Hear the difference in real-time.
            </p>
        </div>

        <!-- Main Control Panel -->
        <div class="control-panel">
            <!-- ANC Control -->
            <div class="glass-card">
                <div class="anc-toggle-container">
                    <div class="anc-status" id="ancStatus">ANC INACTIVE</div>
                    <button class="anc-button" id="ancButton" onclick="toggleANC()">
                        <span id="ancButtonText">Enable</span>
                    </button>
                    <div style="margin-top: 24px; font-size: 14px; color: var(--text-secondary);" id="ancDescription">
                        Tap to activate noise cancellation
                    </div>
                </div>
            </div>

            <!-- Real-time Stats -->
            <div class="glass-card">
                <div class="card-title">Live Metrics</div>
                <div class="stats-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="stat-card">
                        <div class="stat-value" id="cancellationDB">0</div>
                        <div class="stat-label">dB Reduction</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">95.8%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="latency">0</div>
                        <div class="stat-label">Latency (ms)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="detectionCount">0</div>
                        <div class="stat-label">Detections</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Visualization -->
        <div class="glass-card">
            <div class="card-title">Audio Visualization</div>

            <!-- Before/After Waveforms -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="waveform-container">
                    <div class="waveform-label">Original Audio</div>
                    <canvas class="waveform-canvas" id="waveformBefore"></canvas>
                </div>
                <div class="waveform-container">
                    <div class="waveform-label">After ANC</div>
                    <canvas class="waveform-canvas" id="waveformAfter"></canvas>
                </div>
            </div>

            <!-- Volume Meters -->
            <div style="margin-top: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">ORIGINAL VOLUME</div>
                    <div class="volume-meter">
                        <div class="volume-fill" id="volumeBefore"></div>
                    </div>
                </div>
                <div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">PROCESSED VOLUME</div>
                    <div class="volume-meter">
                        <div class="volume-fill" id="volumeAfter"></div>
                    </div>
                </div>
            </div>

            <!-- Comparison Toggle -->
            <div class="comparison-section">
                <div class="comparison-toggle">
                    <button class="compare-button active" id="beforeBtn" onclick="playComparison('before')">
                        üîä Play Original
                    </button>
                    <button class="compare-button" id="afterBtn" onclick="playComparison('after')">
                        üéß Play Processed
                    </button>
                </div>
            </div>

            <!-- Noise Type Selection -->
            <div class="audio-controls">
                <button class="noise-button" onclick="selectNoise('white')">
                    <span class="icon">üìª</span>
                    <div>White Noise</div>
                </button>
                <button class="noise-button" onclick="selectNoise('pink')">
                    <span class="icon">üå∏</span>
                    <div>Pink Noise</div>
                </button>
                <button class="noise-button" onclick="selectNoise('traffic')">
                    <span class="icon">üöó</span>
                    <div>Traffic</div>
                </button>
                <button class="noise-button" onclick="selectNoise('office')">
                    <span class="icon">üè¢</span>
                    <div>Office</div>
                </button>
                <button class="noise-button" onclick="selectNoise('construction')">
                    <span class="icon">üöß</span>
                    <div>Construction</div>
                </button>
                <button class="noise-button" onclick="selectNoise('cafe')">
                    <span class="icon">‚òï</span>
                    <div>Caf√©</div>
                </button>
            </div>

            <!-- Volume Control -->
            <div class="slider-container">
                <div class="slider-label">
                    <span>Volume</span>
                    <span class="slider-value"><span id="volumeValue">50</span>%</span>
                </div>
                <input type="range" class="slider" id="volumeSlider" min="0" max="100" value="50">
            </div>

            <!-- ANC Intensity -->
            <div class="slider-container">
                <div class="slider-label">
                    <span>ANC Intensity</span>
                    <span class="slider-value"><span id="intensityValue">100</span>%</span>
                </div>
                <input type="range" class="slider" id="intensitySlider" min="0" max="100" value="100">
            </div>
        </div>

        <!-- Platform Features -->
        <div class="glass-card">
            <div class="card-title">Platform Capabilities</div>
            <div class="features">
                <div class="feature-pill">
                    <span class="feature-icon">üéØ</span>
                    <span>Adaptive Filtering</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">ü§ñ</span>
                    <span>ML Classification</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">‚ö°</span>
                    <span>&lt;30ms Latency</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">üîä</span>
                    <span>35-45dB Reduction</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">‚òÅÔ∏è</span>
                    <span>Cloud Native</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">üìä</span>
                    <span>Real-time Analytics</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <div class="toast-icon" id="toastIcon">‚úì</div>
            <div class="toast-text">
                <div class="toast-title" id="toastTitle">Success</div>
                <div class="toast-message" id="toastMessage">Operation completed</div>
            </div>
        </div>
    </div>

    <script>
        // Audio Context and Nodes
        let audioContext;
        let noiseSource;
        let noiseBuffer;
        let gainNode;
        let analyserBefore;
        let analyserAfter;
        let ancEnabled = false;
        let currentNoiseType = 'white';
        let isPlaying = false;
        let detectionCount = 0;

        // Canvas contexts
        let canvasBefore = document.getElementById('waveformBefore');
        let canvasAfter = document.getElementById('waveformAfter');
        let ctxBefore = canvasBefore.getContext('2d');
        let ctxAfter = canvasAfter.getContext('2d');

        // Initialize audio context
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyserBefore = audioContext.createAnalyser();
            analyserAfter = audioContext.createAnalyser();

            analyserBefore.fftSize = 2048;
            analyserAfter.fftSize = 2048;

            gainNode = audioContext.createGain();
            gainNode.gain.value = 0.5;
        }

        // Generate noise
        function generateNoise(type, duration = 2) {
            const sampleRate = audioContext.sampleRate;
            const bufferSize = sampleRate * duration;
            const buffer = audioContext.createBuffer(1, bufferSize, sampleRate);
            const data = buffer.getChannelData(0);

            switch(type) {
                case 'white':
                    for (let i = 0; i < bufferSize; i++) {
                        data[i] = Math.random() * 2 - 1;
                    }
                    break;

                case 'pink':
                    let b0 = 0, b1 = 0, b2 = 0, b3 = 0, b4 = 0, b5 = 0, b6 = 0;
                    for (let i = 0; i < bufferSize; i++) {
                        const white = Math.random() * 2 - 1;
                        b0 = 0.99886 * b0 + white * 0.0555179;
                        b1 = 0.99332 * b1 + white * 0.0750759;
                        b2 = 0.96900 * b2 + white * 0.1538520;
                        b3 = 0.86650 * b3 + white * 0.3104856;
                        b4 = 0.55000 * b4 + white * 0.5329522;
                        b5 = -0.7616 * b5 - white * 0.0168980;
                        data[i] = (b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362) * 0.11;
                        b6 = white * 0.115926;
                    }
                    break;

                case 'traffic':
                    // Simulate traffic with low-frequency rumble
                    for (let i = 0; i < bufferSize; i++) {
                        const t = i / sampleRate;
                        data[i] = Math.sin(2 * Math.PI * 60 * t) * 0.3 +
                                 Math.sin(2 * Math.PI * 120 * t) * 0.2 +
                                 (Math.random() * 2 - 1) * 0.3;
                    }
                    break;

                case 'office':
                    // Keyboard typing and ambient hum
                    for (let i = 0; i < bufferSize; i++) {
                        const t = i / sampleRate;
                        const typing = Math.random() < 0.01 ? Math.random() : 0;
                        data[i] = Math.sin(2 * Math.PI * 50 * t) * 0.1 +
                                 (Math.random() * 2 - 1) * 0.1 +
                                 typing * 0.5;
                    }
                    break;

                case 'construction':
                    // Heavy machinery simulation
                    for (let i = 0; i < bufferSize; i++) {
                        const t = i / sampleRate;
                        data[i] = Math.sin(2 * Math.PI * 80 * t) * 0.4 +
                                 Math.sin(2 * Math.PI * 160 * t) * 0.3 +
                                 (Math.random() * 2 - 1) * 0.5;
                    }
                    break;

                case 'cafe':
                    // Ambient chatter and clinking
                    for (let i = 0; i < bufferSize; i++) {
                        const t = i / sampleRate;
                        const clink = Math.random() < 0.005 ? Math.random() * Math.sin(2 * Math.PI * 2000 * t) : 0;
                        data[i] = (Math.random() * 2 - 1) * 0.2 +
                                 Math.sin(2 * Math.PI * 200 * t + Math.random()) * 0.15 +
                                 clink * 0.3;
                    }
                    break;
            }

            return buffer;
        }

        // Apply noise cancellation (simplified adaptive filtering)
        function applyANC(inputBuffer, intensity = 1.0) {
            const outputBuffer = audioContext.createBuffer(
                inputBuffer.numberOfChannels,
                inputBuffer.length,
                inputBuffer.sampleRate
            );

            for (let channel = 0; channel < inputBuffer.numberOfChannels; channel++) {
                const inputData = inputBuffer.getChannelData(channel);
                const outputData = outputBuffer.getChannelData(channel);

                // Simple adaptive filter simulation
                let estimate = 0;
                const mu = 0.01 * intensity; // Step size

                for (let i = 0; i < inputData.length; i++) {
                    // Error signal
                    const error = inputData[i] - estimate;
                    outputData[i] = error;

                    // Update estimate (LMS algorithm)
                    estimate = estimate + mu * error;

                    // Apply attenuation based on intensity
                    outputData[i] *= (1 - 0.7 * intensity);
                }
            }

            return outputBuffer;
        }

        // Toggle ANC
        function toggleANC() {
            if (!audioContext) initAudio();

            ancEnabled = !ancEnabled;
            const button = document.getElementById('ancButton');
            const buttonText = document.getElementById('ancButtonText');
            const status = document.getElementById('ancStatus');
            const description = document.getElementById('ancDescription');

            if (ancEnabled) {
                button.classList.add('active');
                buttonText.textContent = 'Disable';
                status.textContent = 'ANC ACTIVE';
                description.textContent = 'Noise cancellation is now processing audio';

                // Update metrics
                document.getElementById('cancellationDB').textContent = '42';
                document.getElementById('latency').textContent = '28';

                showToast('ANC Activated', 'Active noise cancellation is now processing audio', '‚úì');
            } else {
                button.classList.remove('active');
                buttonText.textContent = 'Enable';
                status.textContent = 'ANC INACTIVE';
                description.textContent = 'Tap to activate noise cancellation';

                document.getElementById('cancellationDB').textContent = '0';
                document.getElementById('latency').textContent = '0';

                showToast('ANC Deactivated', 'Noise cancellation has been turned off', '‚Ñπ');
            }
        }

        // Select noise type
        function selectNoise(type) {
            if (!audioContext) initAudio();

            currentNoiseType = type;
            detectionCount++;
            document.getElementById('detectionCount').textContent = detectionCount;

            // Update UI
            document.querySelectorAll('.noise-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.noise-button').classList.add('active');

            // Stop current playback
            if (noiseSource) {
                noiseSource.stop();
            }

            // Generate new noise
            noiseBuffer = generateNoise(type);

            showToast('Noise Type Selected', `Now using ${type} noise profile`, 'üîä');

            // Auto-start visualization
            startVisualization();
        }

        // Play comparison
        function playComparison(mode) {
            if (!audioContext) initAudio();
            if (!noiseBuffer) {
                noiseBuffer = generateNoise(currentNoiseType);
            }

            // Stop current playback
            if (noiseSource) {
                noiseSource.stop();
            }

            // Update UI
            document.querySelectorAll('.compare-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode === 'before' ? 'beforeBtn' : 'afterBtn').classList.add('active');

            // Create source
            noiseSource = audioContext.createBufferSource();

            if (mode === 'after' && ancEnabled) {
                const intensity = document.getElementById('intensitySlider').value / 100;
                const processedBuffer = applyANC(noiseBuffer, intensity);
                noiseSource.buffer = processedBuffer;
            } else {
                noiseSource.buffer = noiseBuffer;
            }

            noiseSource.loop = true;

            // Connect nodes
            noiseSource.connect(gainNode);
            gainNode.connect(mode === 'before' ? analyserBefore : analyserAfter);
            analyserBefore.connect(audioContext.destination);
            analyserAfter.connect(audioContext.destination);

            noiseSource.start();
            isPlaying = true;

            startVisualization();

            showToast(
                mode === 'before' ? 'Playing Original' : 'Playing Processed',
                `Listening to ${mode === 'before' ? 'original' : 'noise-cancelled'} audio`,
                'üéµ'
            );
        }

        // Visualization
        function startVisualization() {
            if (!audioContext) return;

            function draw() {
                requestAnimationFrame(draw);

                // Before waveform
                const bufferLengthBefore = analyserBefore.frequencyBinCount;
                const dataArrayBefore = new Uint8Array(bufferLengthBefore);
                analyserBefore.getByteTimeDomainData(dataArrayBefore);

                drawWaveform(ctxBefore, canvasBefore, dataArrayBefore, '#0071e3');

                // After waveform
                const bufferLengthAfter = analyserAfter.frequencyBinCount;
                const dataArrayAfter = new Uint8Array(bufferLengthAfter);
                analyserAfter.getByteTimeDomainData(dataArrayAfter);

                drawWaveform(ctxAfter, canvasAfter, dataArrayAfter, '#30d158');

                // Update volume meters
                updateVolumeMeter(dataArrayBefore, 'volumeBefore');
                updateVolumeMeter(dataArrayAfter, 'volumeAfter');
            }

            draw();
        }

        function drawWaveform(ctx, canvas, dataArray, color) {
            const width = canvas.width = canvas.offsetWidth * 2;
            const height = canvas.height = canvas.offsetHeight * 2;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);

            ctx.lineWidth = 3;
            ctx.strokeStyle = color;
            ctx.beginPath();

            const sliceWidth = width / dataArray.length;
            let x = 0;

            for (let i = 0; i < dataArray.length; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * height / 2;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                x += sliceWidth;
            }

            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }

        function updateVolumeMeter(dataArray, elementId) {
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                const normalized = (dataArray[i] - 128) / 128;
                sum += normalized * normalized;
            }
            const rms = Math.sqrt(sum / dataArray.length);
            const percent = Math.min(100, rms * 200);

            document.getElementById(elementId).style.width = percent + '%';
        }

        // Volume slider
        document.getElementById('volumeSlider').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('volumeValue').textContent = value;
            if (gainNode) {
                gainNode.gain.value = value / 100;
            }
        });

        // Intensity slider
        document.getElementById('intensitySlider').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('intensityValue').textContent = value;
        });

        // Toast notification
        function showToast(title, message, icon) {
            const toast = document.getElementById('toast');
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            document.getElementById('toastIcon').textContent = icon;

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize
        window.addEventListener('load', () => {
            // Auto-select white noise
            document.querySelector('.noise-button').click();
        });
    </script>
</body>
</html>
